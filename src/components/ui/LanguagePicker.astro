---
import { languages } from "@utils//ui";
import Icon from "./icons/Icon.astro";
---



<!--Import the necessary Dropdown plugin-->
<!--https://preline.co/plugins/html/dropdown.html-->
<script>
  import "@preline/dropdown/index.js";
</script>

<script>
  // Type alias for supported languages
  type TLanguage = "en" | "fr";
  // array of supported languages
  const languages: TLanguage[] = ["en", "fr"];

  document.addEventListener("DOMContentLoaded", function () {
    const languageLinks = document.querySelectorAll(".hs-dropdown-menu a");
    languageLinks.forEach((element) => {
      const link = element as HTMLAnchorElement;
      const lang = link
        .getAttribute("href")
        ?.replace("/", "")
        .replace("/", "") as TLanguage;

      link.addEventListener("click", function (event) {
        event.preventDefault();

        const url = new URL(window.location.href);
        const pathParts = url.pathname
          .split("/")
          .filter((part) => part && !languages.includes(part as TLanguage));

        if (lang === url.pathname.split("/")[1]) return;

        if (url.pathname.includes("/post")) {
          if (url.pathname.includes("en")) {
            pathParts.unshift(lang);
            pathParts.splice(2, 0, lang);
          } else {
            pathParts.unshift(lang);
            pathParts.splice(2, 0, "en");
          }
        } else {
          if (lang !== "en") {
            pathParts.unshift(lang);
          }
        }

        url.pathname = pathParts.join("/");
        window.location.href = url.toString();
      });
    });
  });
</script>
